<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
    <title>Document</title>
  </head>
  <style> 
  body{ background-color: ivory; }
#canvas{border:1px solid red;}
  </style>
    <script>
        let canvas = document.getElementById("canvas");
        ctx = canvas.getContext("2d")

// letiables used to get mouse position on the canvas
let $canvas = $("#canvas");
let canvasOffset = $canvas.offset();
let offsetX = canvasOffset.left;
let offsetY = canvasOffset.top;
let scrollX = $canvas.scrollLeft();
let scrollY = $canvas.scrollTop();

// letiables to save last mouse position
// used to see how far the user dragged the mouse
// and then move the text by that distance
let startX;
let startY;

// some text objects
let texts = [];

// some test texts
texts.push({text: "Volledige naam", x: 20, y: 160});
texts.push({text: "Nr", x: 20, y: 175});
texts.push({text: "Geb.Datum", x: 20, y: 190});

// calculate width of each text for hit-testing purposes
ctx.font = "16px verdana";
for (let i = 0; i < texts.length; i++) {
    let text = texts[i];
    text.width = ctx.measureText(text.text).width;
    text.height = 16;
}

// this let will hold the index of the selected text
let selectedText = -1;

// START: draw all texts to the canvas
draw();

// clear the canvas draw all texts
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < texts.length; i++) {
        let text = texts[i];
        ctx.fillStyle = "#CCCCCC";
        ctx.fillRect(text.x, text.y, ctx.measureText(text.text).width, -ctx.measureText('M').width); 
        ctx.fillStyle = "blue";
        ctx.fillText(text.text, text.x, text.y);
				ctx.fill();
        
    }
}

// test if x,y is inside the bounding box of texts[textIndex]
function textHittest(x, y, textIndex) {
    let text = texts[textIndex];
    return (x >= text.x && x <= text.x + text.width && y >= text.y - text.height && y <= text.y);
}

// handle mousedown events
// iterate through texts[] and see if the user
// mousedown'ed on one of them
// If yes, set the selectedText to the index of that text
function handleMouseDown(e) {
    e.preventDefault();
    startX = parseInt(e.clientX - offsetX);
    startY = parseInt(e.clientY - offsetY);

    // Put your mousedown stuff here
    for (let i = 0; i < texts.length; i++) {
        if (textHittest(startX, startY, i)) {
            $('#canvas').css('cursor','pointer');
            selectedText = i;
        }
    }
}

// done dragging
function handleMouseUp(e) {
    e.preventDefault();
    selectedText = -1;
    $('#canvas').css('cursor','auto');
}

// also done dragging
function handleMouseOut(e) {
    e.preventDefault();
    selectedText = -1;
}

// handle mousemove events
// calc how far the mouse has been dragged since
// the last mousemove event and move the selected text
// by that distance
function handleMouseMove(e) {
    if (selectedText < 0) {
        return;
    }
    e.preventDefault();
    mouseX = parseInt(e.clientX - offsetX);
    mouseY = parseInt(e.clientY - offsetY);

    // Put your mousemove stuff here
    let dx = mouseX - startX;
    let dy = mouseY - startY;
    startX = mouseX;
    startY = mouseY;

    let text = texts[selectedText];
    text.x += dx;
    text.y += dy;
    draw();
}

// listen for mouse events
$("#canvas").mousedown(function (e) {
    handleMouseDown(e);
});
$("#canvas").mousemove(function (e) {
    handleMouseMove(e);
});
$("#canvas").mouseup(function (e) {
    handleMouseUp(e);
});
$("#canvas").mouseout(function (e) {
    handleMouseOut(e);
});
    </script> 
  <body>
    <h4>Drag the text</h4>

    <canvas id="canvas" width=321 height=204></canvas>
    
  
  </body>

</html>
